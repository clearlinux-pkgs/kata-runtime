From d5850044eaf683af38f502b72782867a24895587 Mon Sep 17 00:00:00 2001
From: Jose Carlos Venegas Munoz <jose.carlos.venegas.munoz@intel.com>
Date: Wed, 23 Jan 2019 00:27:55 -0600
Subject: [PATCH 1/2] makefile: honor DESDIR on install

- Do symlink to a relative path to hypervisor config.
- Create symlink on DESTDIR

Fixes: #1161

Signed-off-by: Jose Carlos Venegas Munoz <jose.carlos.venegas.munoz@intel.com>
---
 Makefile | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/Makefile b/Makefile
index 1c11f74..2a084df 100644
--- a/Makefile
+++ b/Makefile
@@ -248,11 +248,11 @@ ifeq (,$(findstring $(DEFAULT_HYPERVISOR),$(KNOWN_HYPERVISORS)))
 endif
 
 ifeq ($(DEFAULT_HYPERVISOR),$(HYPERVISOR_QEMU))
-    DEFAULT_HYPERVISOR_CONFIG_PATH = $(CONFIG_PATH_QEMU)
+    DEFAULT_HYPERVISOR_CONFIG = $(CONFIG_FILE_QEMU)
 endif
 
 ifeq ($(DEFAULT_HYPERVISOR),$(HYPERVISOR_FC))
-    DEFAULT_HYPERVISOR_CONFIG_PATH = $(CONFIG_PATH_FC)
+    DEFAULT_HYPERVISOR_CONFIG = $(CONFIG_FILE_FC)
 endif
 
 CONFDIR := $(DEFAULTSDIR)/$(PROJECT_DIR)
@@ -546,7 +546,7 @@ install-bin-libexec: $(BINLIBEXECLIST)
 
 install-configs: $(CONFIGS)
 	$(QUIET_INST)$(foreach f,$(CONFIGS),$(call INSTALL_CONFIG,$f,$(dir $(CONFIG_PATH))))
-	$(QUIET_INST)ln -sf $(DEFAULT_HYPERVISOR_CONFIG_PATH) $(CONFIG_PATH)
+	$(QUIET_INST)ln -sf $(DEFAULT_HYPERVISOR_CONFIG) $(DESTDIR)/$(CONFIG_PATH)
 
 install-scripts: $(SCRIPTS)
 	$(QUIET_INST)$(foreach f,$(SCRIPTS),$(call INSTALL_EXEC,$f,$(SCRIPTS_DIR)))
-- 
2.20.0

